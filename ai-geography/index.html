<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI World Geography - Game Room</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #0f172a; overflow: hidden; font-family: sans-serif; }
        #game-container { position: relative; width: 100vw; height: 100vh; background: #1e293b; }
        #map-svg { width: 100%; height: 100%; }
        .country-path { stroke: #94a3b8; stroke-width: 0.5px; cursor: pointer; transition: fill 0.2s; fill: #334155; }
        .country-path:hover { fill: #64748b !important; }
        .hud { position: absolute; z-index: 10; pointer-events: none; }
        .hud-content { pointer-events: auto; background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(10px); border: 1px solid #334155; border-radius: 1.5rem; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); }
        #tooltip { position: absolute; opacity: 0; pointer-events: none; background: #0f172a; color: white; padding: 5px 12px; border-radius: 8px; border: 2px solid #22d3ee; font-size: 16px; font-weight: bold; z-index: 100; }
    </style>
</head>
<body>

    <div id="game-container">
        <div id="start-screen" class="fixed inset-0 z-50 bg-slate-900 flex flex-col items-center justify-center p-6 text-center">
            <h1 class="text-6xl font-black mb-6 text-transparent bg-clip-text bg-gradient-to-r from-emerald-400 to-cyan-400 uppercase tracking-tight">World Explorer</h1>
            <p class="text-2xl mb-10 max-w-lg text-slate-300">Alani and Wilder, find countries to win 1000 points! Wilder, follow the bright blue highlights!</p>
            <button id="start-btn" class="bg-emerald-500 hover:bg-emerald-600 text-white font-bold py-6 px-16 rounded-full text-4xl shadow-2xl transition-all hover:scale-110 active:scale-95">START ADVENTURE</button>
        </div>

        <div id="winner-screen" class="hidden fixed inset-0 z-50 bg-emerald-900/98 flex flex-col items-center justify-center p-6 text-center">
            <div class="text-9xl mb-6">üèÜ</div>
            <h1 id="winner-text" class="text-8xl font-black mb-4 text-white"></h1>
            <button onclick="location.reload()" class="bg-white text-emerald-900 font-black py-4 px-12 rounded-full text-3xl shadow-2xl">PLAY AGAIN</button>
        </div>

        <div class="hud top-4 left-4">
            <div class="hud-content p-4 flex gap-8">
                <div id="box-Alani" class="text-center transition-opacity"><p class="text-xs font-black text-emerald-400">ALANI</p><p id="score-Alani" class="text-4xl font-mono font-bold text-white">0</p></div>
                <div class="w-px bg-slate-700 h-12"></div>
                <div id="box-Wilder" class="text-center opacity-50 transition-opacity"><p class="text-xs font-black text-cyan-400">WILDER</p><p id="score-Wilder" class="text-4xl font-mono font-bold text-white">0</p></div>
            </div>
        </div>

        <div class="hud top-4 right-4 text-right">
            <div class="hud-content p-6 border-2 border-cyan-500/50 min-w-[300px]">
                <p id="turn-label" class="text-cyan-400 text-sm font-black uppercase mb-1"></p>
                <p class="text-slate-500 text-xs uppercase font-bold">Find this country:</p>
                <h2 id="target-country" class="text-5xl font-black text-white leading-tight">---</h2>
                <p id="hint-text" class="text-amber-300 text-sm font-bold italic mt-4 hidden bg-amber-900/40 p-3 rounded-xl border border-amber-500/30">üí° Hint: Look in the bright blue area!</p>
            </div>
        </div>

        <div id="fact-container" class="hud bottom-8 left-8 opacity-0 transition-opacity duration-500 max-w-md z-20 pointer-events-none">
            <div class="hud-content border-emerald-500/50 p-6">
                <div class="flex items-center gap-3 mb-2"><span class="text-2xl">ü§ñ</span><h4 class="text-emerald-400 font-black text-xs uppercase tracking-widest">Gemini AI Fact</h4></div>
                <p id="fact-text" class="text-lg text-slate-100 leading-snug font-medium italic"></p>
            </div>
        </div>

        <svg id="map-svg"></svg>
        <div id="tooltip"></div>
    </div>

    <script>
        const players = ['Alani', 'Wilder'];
        let currentPlayer = 'Alani';
        let scores = { Alani: 0, Wilder: 0 };
        let targetCountry = null;
        let countriesData = [];
        let currentContinent = "";

        const funnyFacts = {
            "Canada": "Canada has more lakes than all other countries combined! It's basically a giant water park!",
            "Brazil": "Brazil has more types of monkeys than anywhere else! Ooh ooh aah aah!",
            "Australia": "Australia is wider than the moon! If you walked across it, you might bump into space!",
            "Italy": "Italy has a fountain that pours free red wine for everyone. Papa Pooh would love to visit!",
            "Japan": "Japan has square watermelons so they don't roll off the table!",
            "France": "France is the most visited place on Earth. Everyone wants a croissant!",
            "United States of America": "People in America eat 100 acres of pizza every single day. That's a lot of pepperoni!",
            "Egypt": "The Great Pyramid of Giza was the tallest thing on Earth for 3,800 years!",
            "Russia": "Russia is so big it has 11 different time zones!",
            "China": "China's Great Wall is long enough to wrap around the Earth half-way!",
            "Portugal": "Portugal is the oldest country in Europe! It also has the world's oldest bookstore!",
            "Switzerland": "In Switzerland, it is illegal to own just one guinea pig because they get lonely. You must have two!",
            "Mexico": "The Great Pyramid of the world isn't in Egypt‚Äîit's actually in Mexico, hidden under a hill!",
            "United Kingdom": "In the UK, it's illegal to handle a salmon in suspicious circumstances. Don't be sneaky with your fish!",
            "Norway": "Norway once knighted a penguin named Nils Olav. He is a very fancy bird!",
            "Germany": "Germany has over 1,000 kinds of sausages. That's a lot of hot dogs!",
            "Spain": "Spain has a festival where people throw thousands of tomatoes at each other just for fun!",
            "India": "India has a floating post office that sits on a boat in a lake!",
            "Thailand": "In Thailand, it is illegal to step on money because it has the King's face on it!"
        };

        const genericJokes = [
            "This country is so cool, even the polar bears want to live there!",
            "I heard the birds here sing in three different languages!",
            "This place is famous for having the world's most polite squirrels!",
            "If you visited this country, you might accidentally become a professional explorer!",
            "I bet the ice cream here never melts because the country is just too cool!"
        ];

        const continentsMap = {
            "Canada": "North America", "United States of America": "North America", "Mexico": "North America",
            "Brazil": "South America", "Argentina": "South America", "Chile": "South America",
            "France": "Europe", "Italy": "Europe", "Germany": "Europe", "Spain": "Europe", "United Kingdom": "Europe", "Portugal": "Europe", "Switzerland": "Europe", "Norway": "Europe",
            "China": "Asia", "India": "Asia", "Japan": "Asia", "Thailand": "Asia", "Russia": "Asia",
            "Egypt": "Africa", "South Africa": "Africa", "Nigeria": "Africa", "Kenya": "Africa",
            "Australia": "Oceania", "New Zealand": "Oceania"
        };

        function speak(text, onEnd) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(text);
            const voices = window.speechSynthesis.getVoices();
            const preferredVoice = voices.find(v => v.name.includes('Female') || v.name.includes('Google US English') || v.name.includes('Samantha') || v.name.includes('Zira'));
            if (preferredVoice) utterance.voice = preferredVoice;
            utterance.pitch = 1.2;
            utterance.rate = 0.9;
            utterance.onend = onEnd;
            window.speechSynthesis.speak(utterance);
        }

        window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

        const svg = d3.select("#map-svg");
        const g = svg.append("g");
        const projection = d3.geoMercator().scale(window.innerWidth / 6.5).translate([window.innerWidth / 2, window.innerHeight / 1.5]);
        const path = d3.geoPath().projection(projection);

        svg.call(d3.zoom().scaleExtent([1, 15]).on("zoom", (e) => g.attr("transform", e.transform)));

        d3.json("https://raw.githubusercontent.com/datasets/geo-countries/master/data/countries.geojson").then(data => {
            countriesData = data.features;
            g.selectAll("path").data(countriesData).enter().append("path")
                .attr("d", path).attr("class", "country-path")
                .on("mouseover", function(event, d) {
                    const name = d.properties.ADMIN || d.properties.name || d.properties.name_en;
                    d3.select("#tooltip").style("opacity", 1).html(name).style("left", (event.pageX + 15) + "px").style("top", (event.pageY - 20) + "px");
                    d3.select(this).style("stroke", "#fff").style("stroke-width", "2px");
                })
                .on("mouseout", function() {
                    d3.select("#tooltip").style("opacity", 0);
                    d3.select(this).style("stroke", "#94a3b8").style("stroke-width", "0.5px");
                })
                .on("click", (e, d) => {
                    const clickedName = d.properties.ADMIN || d.properties.name || d.properties.name_en;
                    handleCountryClick(clickedName);
                });
        });

        document.getElementById('start-btn').onclick = () => {
            document.getElementById('start-screen').classList.add('hidden');
            speak("Hi Alani and Wilder! Let's explore the world together. First to 1000 points is the winner. Alani, find the first country!", nextRound);
        };

        function nextRound() {
            if (scores.Alani >= 1000 || scores.Wilder >= 1000) { endGame(); return; }
            const list = Object.keys(continentsMap);
            targetCountry = list[Math.floor(Math.random() * list.length)];
            currentContinent = continentsMap[targetCountry];
            document.getElementById('target-country').innerText = targetCountry;
            document.getElementById('turn-label').innerText = currentPlayer + "'s Turn";
            document.getElementById('fact-container').style.opacity = "0";
            document.getElementById('box-Alani').style.opacity = (currentPlayer === 'Alani' ? "1" : "0.3");
            document.getElementById('box-Wilder').style.opacity = (currentPlayer === 'Wilder' ? "1" : "0.3");
            const hint = document.getElementById('hint-text');
            if (currentPlayer === 'Wilder') {
                hint.innerText = "üí° Hint: It's in " + currentContinent;
                hint.classList.remove('hidden');
            } else { hint.classList.add('hidden'); }
            g.selectAll("path").transition().duration(500).style("fill", d => {
                const name = d.properties.ADMIN || d.properties.name || d.properties.name_en;
                if (currentPlayer === 'Wilder' && continentsMap[name] === currentContinent) return "#0ea5e9";
                return "#334155";
            });
        }

        function handleCountryClick(name) {
            if (name === targetCountry) {
                scores[currentPlayer] += 200;
                document.getElementById('score-' + currentPlayer).innerText = scores[currentPlayer];
                const fact = funnyFacts[name] || genericJokes[Math.floor(Math.random() * genericJokes.length)];
                document.getElementById('fact-text').innerText = fact;
                document.getElementById('fact-container').style.opacity = "1";
                speak("You got it! " + fact, () => { switchPlayer(); });
            } else {
                speak("Not that one! That was " + name + ". Let's try another turn!", () => { switchPlayer(); });
            }
        }

        function switchPlayer() {
            currentPlayer = currentPlayer === 'Alani' ? 'Wilder' : 'Alani';
            speak("It is now " + currentPlayer + "'s turn.", nextRound);
        }

        function endGame() {
            const winner = scores.Alani >= 1000 ? 'Alani' : 'Wilder';
            document.getElementById('winner-text').innerText = winner + " Wins!";
            document.getElementById('winner-screen').classList.remove('hidden');
            speak("We have a champion! Congratulations " + winner + "! You are the greatest explorer in the world!");
        }
    </script>
</body>
</html>
